<html>
   <head>

      <title>Feature Toggle Configurations Status (fetched at: 23/08/2023 12:23)</title>

      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
      <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">



      <script type="text/javascript" language="javascript" src="https://code.jquery.com/jquery-3.7.0.js"></script>
      <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
      <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
      <script type="text/javascript" language="javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.2/moment.min.js"></script>


      <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js" data-auto-replace-svg="nest" data-observe-insertions="true"></script>
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

      <script>


                  var xValues = new Set();;
                  var yValues = [];
                  var barColors = ["green"]
                  var table;

                  $(document).ready(function() {


                        table = $('#table').DataTable( {
                                    select: true,
                                    "columnDefs": [
                                        { "width": "15%", "targets": 0 }
                                      ],
                                      pagingType: 'full_numbers'
                                } );

                   });

                  $.get("https://wmashal.github.io/test-jsons/ft3.json", function(data) {
                    //console.log(data);

                    const groupByToggleName = data["feature-toggles"].reduce((group, item) => {
                    const { name } = item;
                      group[name] = group[name] ?? [];
                      group[name].push(item);
                      return group;
                    }, {});


                    const groupByLandscape = data["feature-toggles"].reduce((group, item) => {
                    const { landscape } = item;
                      group[landscape] = group[landscape] ?? [];
                      group[landscape].push(item);
                      return group;
                    }, {});



                    var count = 0;
                    $.each(groupByToggleName, function(key,value) {

                      var item = value[count++];
                      var row = document.createElement("tr");
                      var rowArr = [];

                      var nameCell = document.createElement("td");
                      nameCell.textContent = key;
                      rowArr.push($(nameCell).html())

                      var componentNameCell = document.createElement("td");
                      componentNameCell.textContent = item["componentName"];
                      rowArr.push($(componentNameCell).html())


                      var createdByCell = document.createElement("td");
                      createdByCell.textContent = item["createdBy"];
                      rowArr.push($(createdByCell).html())

                      var creationTimestamp = document.createElement("td");
                      creationTimestamp.textContent = item["creationTimestamp"];
                      rowArr.push($(creationTimestamp).html())


                      // Create cells for each landscape
                      var numberOfTogglesPerLandscape = 0;
                      $.each(value, function(key,togglevalue) {
                        console.info(togglevalue["landscape"])
                        xValues.add(togglevalue["landscape"]);

                        var landscapeCell = document.createElement("td");
                        state = togglevalue["enabled"] === false ? $(landscapeCell).append('<i class="fa-solid fa-toggle-on" style="color: #bd0000;"></i>') : $(landscapeCell).append('<i class="fa-solid fa-toggle-on" style="color: #3b9c07;"></i>');

                        if(togglevalue["locked"] === "true"){
                            $(landscapeCell).append('  <i class="fa-solid fa-lock" style="color: #cc0000;"></i>')
                        }else{
                            $(landscapeCell).append('  <i class="fa-solid fa-unlock" style="color: #249b03;"></i>')
                        }

                        rowArr.push($(landscapeCell).html())
                      });

                      console.log(rowArr)
                      table.row
                          .add(rowArr)
                          .draw(false);

                    });

                    $.each(groupByLandscape, function(key,value) {
                      console.info(key)
                      yValues.push(value.length)
                    });

                    console.log(xValues);
                    console.log(yValues);

                    const landscapesTogglesCounterBarChart = new Chart("landscapesTogglesCounterBarChart", {
                        type: "bar",
                        data: {
                          labels: Array.from(xValues),
                          datasets:[{
                            label: '# of Feature Toggles',
                            backgroundColor: barColors,
                            data: yValues,
                            borderWidth: 1
                          }]
                        },
                          options: {
                            scale: {
                                ticks: {
                                  precision: 0
                                }
                              }
                          }
                      });
                  });

      </script>

   </head>
   <body>
      <br>
      <canvas id="landscapesTogglesCounterBarChart" style="width:100%;max-width:700px;height:100px"></canvas>
      <br>
      <br>
            <table id="table" class="table table-striped table-bordered" style="width:100%">
            	<thead>
                  <th>Name</th>
                  <th>Component Name</th>
                  <th>Created By</th>
                  <th>Creation Date</th>
                  <th>Staging</th>
                  <th>Perf</th>
                  <th>Integrate</th>
                  <th>Canary</th>
                  <th>Hotfix</th>
                  <th>Live</th>
            	</thead>
            	<tbody>
            	</tbody>
            </table>
   </body>
</html>
